const User = require('../models/users');

module.exports.profile = function(req, res){
    return res.render('user_profile',{
        title : 'profile'
    })
}

//signup page
module.exports.signup=function(req,res){

    if(req.isAuthenticated()){
        return res.redirect('/users/profile');
    }
     return res.render('signup',{
        title : 'Sign Up to codeial'
    })
}

//sign in page
module.exports.signin=function(req,res){
    if(req.isAuthenticated()){
        return res.redirect('/users/profile');
    }
       return res.render('signin',{
        title : 'Login to codeial'
    })
}


module.exports.createAccount=function(req,res){
      if(req.body.password != req.body.confirmPassword){
           return res.redirect('back');
        }

        User.findOne({email: req.body.email}, function (err,user){
            if(err){ console.log('Error in finding email on signup page'); return}
            if(!user){

                User.create(
                    req.body
                    //old method used instead of directly using req.body
                    // {
                    // email: req.body.email,
                    // password: req.body.password,
                    // name: req.body.accountHolder
                    // }
                , function (err, newUser) {
                    if (err) {console.log('Error in creating User ', err); return;}
                     
                    return res.redirect('/users/signin');
                            })

            }else{
                console.log('Error email id is already in use');
                return res.redirect('back');
            }
        })
   
}


// signin Auth process creates session
module.exports.loginCreateSession=function(req,res){
    return res.redirect('/users/profile');
}



// signout process | destroy session
module.exports.signout=function(req,res){
    // res.clearCookie('user_id'); // old manual method not used
    req.logout(function(err) { // function by passport
        if (err) { return next(err); }
        res.redirect('/');
    });
      }
      
